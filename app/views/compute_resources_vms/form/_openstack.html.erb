<% new = f.object && f.object.id.blank? %>
<%= text_f f, :name, :disabled => !new if show_vm_name? %>
<%= select_f f, :flavor_ref, compute_resource.flavors, :id, :name, {}, :label => _('Flavor') %>
<%
   arch ||= nil ; os ||= nil
   images = possible_images(compute_resource, arch, os)
%>
<div id='image_selection'>
  <%= select_f f, :image_ref, images, :uuid, :name,
               { :include_blank => (images.empty? || images.size == 1) ? false : _('Please select an image') },
               { :disabled => images.empty?, :label => _("Image") } %>
</div>
<%= select_f f, :tenant_id, compute_resource.tenants, :id, :name, {}, :label => _('Tenant') %>

<%= select_f f, :security_group, compute_resource.security_groups, :name, :name, { :include_blank => _("None") }, :label => _("Security group")  %>
<%= selectable_f f, :network, compute_resource.address_pools, { :include_blank => _("None") }, { :label => _("Floating IP network") } %>

<br/>
<div class="children_fields">
  <%= new_child_fields_template(f, :block_device_mapping, {
        :object  => FogExtensions::Openstack::Server::BlockDeviceMapping::Block.new, 
        :partial => 'compute_resources_vms/form/openstack/block_device_mapping', 
        :form_builder_attrs => { :compute_resource => compute_resource } } ) %>

  <%= field_set_tag "Block device mapping", :id => "block_device_mapping", :title => _('Block device mapping') do %>
    <%= f.fields_for :block_device_mapping do |i| %>
      <%= render 'compute_resources_vms/form/openstack/block_device_mapping', :f => i, :compute_resource => compute_resource %>
    <% end %>
    <%= add_child_link '+ ' + _("Add block"), :block_device_mapping, { :class => "info disable-unsupported", :title => _('add new volume/image block') } %>

  <% end %>
</div>


